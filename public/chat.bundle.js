(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{122:function(e,a,t){"use strict";var n=t(34),r=t.n(n),s=t(0),l=t.n(s);a.a=function(e){return l.a.createElement("svg",r()({viewBox:"0 0 24 24",width:"24",height:"24"},e),l.a.createElement("path",{d:"M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm-3.54-4.46a1 1 0 0 1 1.42-1.42 3 3 0 0 0 4.24 0 1 1 0 0 1 1.42 1.42 5 5 0 0 1-7.08 0zM9 11a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm6 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"}))}},285:function(e,a){},531:function(e,a,t){},533:function(e,a,t){e.exports=t.p+"0ce16bb678d46f2fa7ee900a836cdc8e.svg"},534:function(e,a,t){e.exports={"spinner-parent":"_1bXKkmuCyRlq5K6H1MN-3a",spinner:"_1d-XUURtq_Usrxlm7jbYcI",spin:"_28jbo546yynUOWDADfDkZ3"}},535:function(e,a,t){e.exports=t.p+"ba4e5306b2a697394104eb080eac80c9.svg"},550:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),s=t(1),l=t(76),c=t.n(l),o=t(259),i=t.n(o),m=t(288);const u=r.a.createContext(null);function d(){return{state:{socket:i()(),channels:[],whoIsTyping:[],chatMessages:[],typingTimeout:void 0,currentChannel:void 0,isTyping:!1,contentShouldScrollDown:!1,channelFetchError:!1},performEffect:e=>{e({type:"fetch-channels"})}}}var h=function(e,a){const t=e.state;return Object(m.a)(e,e=>{const{payload:n}=a,{socket:r}=e.state;switch(e.state.contentShouldScrollDown=!1,e.performEffect=void 0,a.type){case"fetch-channels":e.state.channelFetchError=!1,e.performEffect=e=>{c.a.get("/api/chat-channels").then(e=>e.data.chatChannels).then(a=>e({type:"set-channels",payload:{channels:a}})).catch(()=>e({type:"channel-list-fetch-error"}))};break;case"set-channels":e.state.channels=n.channels;break;case"channel-list-fetch-error":e.state.channelFetchError=!0;break;case"change-channel":if(!r)break;Object.assign(e.state,{message:"",isTyping:!1,typingTimeout:void 0,currentChannel:e.state.currentChannel&&e.state.currentChannel._id===n.channel._id?void 0:n.channel,chatMessages:[],whoIsTyping:[]}),e.performEffect=()=>{clearTimeout(t.typingTimeout),r.emit("join channel",n.channel._id),t.currentChannel&&(r.emit("stop typing",{username:n.user.username,channelId:t.currentChannel._id}),r.emit("leave channel",t.currentChannel._id))};break;case"start-typing":if(!r)break;e.state.isTyping=!0,e.performEffect=e=>{e({type:"set-typing-timeout",payload:{timeout:setTimeout(()=>{e({type:"stop-typing",payload:{user:n.user}})},4e3)}}),t.isTyping||r.emit("start typing",{username:n.user.username,channelId:t.currentChannel._id}),clearTimeout(t.typingTimeout)};break;case"set-typing-timeout":e.state.typingTimeout=n.timeout;break;case"stop-typing":if(!r)break;e.state.isTyping=!1,e.performEffect=()=>{clearTimeout(t.typingTimeout),r.emit("stop typing",{username:n.user.username,channelId:t.currentChannel._id})};break;case"send-message":if(!r||!n.message)break;e.state.isTyping=!1,e.performEffect=()=>{clearTimeout(t.typingTimeout),r.emit("chat message",{user:n.user,message:n.message,channelId:t.currentChannel._id}),r.emit("stop typing",{username:n.user.username,channelId:t.currentChannel._id})};break;case"scroll-chat-to-bottom":e.state.contentShouldScrollDown=!0;break;case"recieve-message":e.state.chatMessages.push(n.chatMessage),e.state.contentShouldScrollDown=!0;break;case"add-user-typing":e.state.whoIsTyping.push(n.username);break;case"remove-user-typing":{const a=t.whoIsTyping.indexOf(n.username);-1!==a&&e.state.whoIsTyping.splice(a,1);break}}})},p=t(289),g=t.n(p),f=t(129),y=t(103),v=t(202),b=t(205),E=t(197),x=t(44),C=t(204),N=(t(175),t(546)),w=t(6),k=t.n(w),T=t(12);const O={maxHeight:"16em"};function S({messageInputRef:e}){const[,a]=r.a.useContext(u),[t]=r.a.useContext(T.a),n=r.a.useCallback(n=>{n.preventDefault(),a({type:"send-message",payload:{user:t,message:e.current.value.trim()}}),e.current.value=""},[a,t,e]),s=r.a.useCallback(e=>{"Enter"!==e.key||e.shiftKey||n(e)},[n]),l=r.a.useCallback(()=>{a({type:"start-typing",payload:{user:t}})},[a,t]);return r.a.useEffect(()=>{const a=e.current;a&&(a.style.height="auto",a.style.height=a.scrollHeight+"px")}),r.a.createElement("form",{className:"flex flex-grow mr-4",onSubmit:n},r.a.createElement("label",{className:"w-full flex items-center",htmlFor:"message-input"},r.a.createElement("div",{className:"sr-only"},"Send a message"),r.a.createElement("textarea",{className:["bg-gray-200","w-full","placeholder-gray-800","resize-none","outline-none","overflow-y-auto","overflow-x-hidden","px-3","py-2","rounded-l-lg"].join(" "),style:O,id:"message-input",rows:"1",placeholder:"Send a message",onChange:l,onKeyDown:s,autoComplete:"off",ref:e})))}S.propTypes={messageInputRef:k.a.oneOfType([k.a.func,k.a.shape({current:k.a.any})])},S.defaultProps={messageInputRef:r.a.createRef()};var j=r.a.memo(S),_=t(122),I=t(77),R=t(63);function z({bgClassName:e,children:a,onClose:t,isOpen:n}){return Object(R.a)(()=>{function e(e){"Esc"!==e.key&&"Escape"!==e.key||t(e)}return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),r.a.createElement("div",{className:n?"":"invisible"},r.a.createElement("button",{type:"button",className:"fixed inset-0 w-full h-full cursor-default z-40 "+e,onClick:t,"aria-label":"Close menu",tabIndex:"-1"}),r.a.createElement("div",{className:"relative z-50"},a))}z.propTypes={bgClassName:k.a.string,children:k.a.node,onClose:k.a.func,isOpen:k.a.bool},z.defaultProps={bgClassName:"",children:null,onClose:I.a(),isOpen:!1};var M=z,D=t(69);t(531);function F(){const[e]=r.a.useContext(u),[a,t]=r.a.useState(!1),s=r.a.useRef(null),l=r.a.useCallback(()=>{t(!1)},[]),c=r.a.useCallback(()=>{t(f.a)},[]),o=r.a.useCallback(e=>{s.current.value+=e.native},[s]),i=r.a.useMemo(()=>y.a(v.a([[b.a,()=>r.a.createElement(r.a.Fragment,null," ")],[e=>1===e.length,e=>r.a.createElement(r.a.Fragment,null,e," is typing...")],[e=>(e.length+1)/2<=3,e=>r.a.createElement(r.a.Fragment,null,e," are typing...")],[E.a,()=>"Several people are typing..."]]),x.a(e=>r.a.createElement(n.Fragment,{key:g()()},e)),C.a(" and "),x.a(e=>r.a.createElement("span",{className:"font-bold"},e)))(e.whoIsTyping),[e.whoIsTyping]);return r.a.createElement("div",{className:"mt-6 mb-1 mx-6"},r.a.createElement("div",{className:"flex items-center -mb-1"},r.a.createElement("div",{className:"rounded-lg bg-gray-200 flex w-full"},r.a.createElement(j,{messageInputRef:s}),r.a.createElement("button",{className:"px-2 text-gray-600 hover:text-gray-700",type:"button",onClick:c},r.a.createElement(_.a,{className:"fill-current"})),r.a.createElement(M,{onClose:l,isOpen:a},r.a.createElement("div",{className:"absolute right-0 bottom-0 mb-12 shadow-md"},r.a.createElement(N.a,{set:"google",emoji:"",title:"",onSelect:o,color:D.theme.colors.blue[500]}))))),r.a.createElement("div",{className:"ml-2 text-gray-700 mt-1"},i))}var P=r.a.memo(F),H=t(532),V=t(206),q=t(203);function A({message:e}){const a=r.a.useRef(!0),[t,n]=r.a.useState(null),[s,l]=r.a.useState(!0),c=r.a.useCallback(()=>{setTimeout(()=>{a.current&&l(!0)},6e4)},[l]);return r.a.useEffect(()=>{if(s){l(!1);const a=H.DateTime.fromISO(e.sent),t=H.DateTime.local().diff(a,"minutes").toObject().minutes;V.a(n,v.a([[q.a(1),V.a(()=>"Just now",c)],[q.a(10),V.a(()=>a.toRelative(),c)],[E.a,()=>a.toLocaleString(H.DateTime.DATETIME_MED)]]))(t)}},[e.sent,t,s,c]),Object(R.a)(()=>()=>{a.current=!1}),r.a.createElement("div",{className:"my-3"},r.a.createElement("div",null,r.a.createElement("span",{className:"font-bold mr-1"},e.user?e.user.username:r.a.createElement(r.a.Fragment,null," ")),r.a.createElement("span",{className:"text-xs text-gray-700"},r.a.createElement("time",{dateTime:e.sent},t))),r.a.createElement("div",{className:"whitespace-pre-line"},e.message))}A.propTypes={message:k.a.shape({user:k.a.shape({username:k.a.string}),sent:k.a.string,message:k.a.string}).isRequired};var $=r.a.memo(A);function L({children:e,direction:a}){return r.a.createElement("div",{className:"my-8 flex flex-grow bg-white rounded-lg shadow-xl "+a},e)}L.propTypes={children:k.a.node,direction:k.a.string},L.defaultProps={children:null,direction:"flex-row"};var B=L,K=t(533),U=t.n(K);var J=function(){return r.a.createElement(B,null,r.a.createElement("div",{className:"relative flex flex-grow items-center overflow-hidden"},r.a.createElement("img",{className:"absolute opacity-25 select-none right-0",alt:"Woman looking at phone with chat message icon",src:U.a}),r.a.createElement("div",{className:"mx-12 mb-8 z-10"},r.a.createElement("h1",{className:"text-5xl whitespace-normal leading-tight font-bold",style:{fontFamily:"Raleway, sans-serif"}},"No channel selected"),r.a.createElement("p",{className:"text-gray-700 text-xl mt-4"},"To start chatting, join or create a channel from the sidebar"))))},W=t(534),X=t.n(W);var Y=function(){return r.a.createElement(B,null,r.a.createElement("div",{className:"flex flex-grow justify-center items-center"},r.a.createElement("h1",{className:"text-2xl text-gray-700"},"Loading..."),r.a.createElement("div",{className:"w-48 h-48 flex justify-center items-center "+X.a["spinner-parent"]},r.a.createElement("div",{className:"rounded-full w-20 h-20 bg-blue-200 "+X.a.spinner}))))},Z=t(535),G=t.n(Z);var Q=function(){return r.a.createElement(B,null,r.a.createElement("div",{className:"flex flex-col items-center justify-center"},r.a.createElement("div",{className:"ml-8"},r.a.createElement("h1",{className:"text-5xl whitespace-normal leading-tight font-bold",style:{fontFamily:"Raleway, sans-serif"}},"A server error has occurred."),r.a.createElement("p",{className:"text-gray-700 text-xl mt-2 mb-5"},"Please try again later")),r.a.createElement("img",{className:"w-3/5",alt:"Man looking at map",src:G.a})))},ee=t(34),ae=t.n(ee);var te=function(e){return r.a.createElement("svg",ae()({viewBox:"0 0 24 24",width:"24",height:"24"},e),r.a.createElement("path",{d:"M6 14H4a2 2 0 0 1-2-2V4c0-1.1.9-2 2-2h12a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v13a1 1 0 0 1-1.7.7L16.58 18H8a2 2 0 0 1-2-2v-2zm0-2V8c0-1.1.9-2 2-2h8V4H4v8h2zm14-4H8v8h9a1 1 0 0 1 .7.3l2.3 2.29V8z"}))};function ne(){const[e,a]=r.a.useContext(u),[t,n]=r.a.useState(void 0),s=r.a.useRef(null);return r.a.useEffect(()=>{e.contentShouldScrollDown&&s.current&&(s.current.scrollTop=s.current.scrollHeight)},[e.contentShouldScrollDown]),r.a.useEffect(()=>{n(void 0),e.currentChannel&&c.a.get(`/api/chat-channels/${e.currentChannel._id}?limit=9999`).then(e=>e.data).then(e=>e.chatChannel).then(n).then(()=>a({type:"scroll-chat-to-bottom"})).catch(()=>n(new Error("A server error has occurred.")))},[e.currentChannel,a]),e.currentChannel?t?t instanceof Error?r.a.createElement(Q,null):r.a.createElement(B,{direction:"flex-col"},r.a.createElement("div",{className:"mt-4 mb-3 mx-6"},r.a.createElement("h1",{className:"text-xl font-bold text-gray-900"},r.a.createElement(te,{className:"fill-current inline mr-4 text-gray-700"}),t.name)),r.a.createElement("hr",null),r.a.createElement("div",{className:"flex-grow px-8 overflow-y-scroll",ref:s},r.a.createElement("div",{className:"relative"},r.a.createElement("div",{className:"absolute py-4 w-full break-words pr-24"},t.messages&&t.messages.map(e=>r.a.createElement($,{key:e._id,message:e})),e.chatMessages.map(e=>r.a.createElement($,{key:e._id,message:e}))))),r.a.createElement("hr",null),r.a.createElement(P,null)):r.a.createElement(Y,null):r.a.createElement(J,null)}var re=r.a.memo(ne);function se({channel:e}){const[a,t]=r.a.useContext(u),[n]=r.a.useContext(T.a),s=r.a.useCallback(()=>t({type:"change-channel",payload:{channel:e,user:n}}),[t,n,e]);return r.a.createElement("button",{className:"block w-full text-left p-1 pl-4 rounded-lg truncate font-bold "+(a.currentChannel&&a.currentChannel._id===e._id?"text-blue-700 hover:text-blue-900 bg-blue-100":"hover:text-gray-900 hover:bg-gray-200"),type:"button",onClick:a.fetchingChannel?I.a():s},e.name)}se.propTypes={channel:k.a.shape({_id:k.a.string,name:k.a.string}).isRequired};var le=r.a.memo(se),ce=t(90);function oe({bgClassName:e,onClose:a,isOpen:t,children:n}){return r.a.createElement(M,{bgClassName:e,onClose:a,isOpen:t},r.a.createElement("div",{className:"fixed w-screen h-screen inset-0 pointer-events-none"},r.a.createElement("div",{className:"flex w-screen h-screen items-center justify-center"},r.a.createElement("div",{className:"pointer-events-auto"},n))))}oe.propTypes={bgClassName:k.a.string,children:k.a.node,onClose:k.a.func,isOpen:k.a.bool},oe.defaultProps={bgClassName:"bg-gray-900 opacity-25",children:null,onClose:I.a(),isOpen:!1};var ie=oe,me=t(89),ue=t(60);function de({isOpen:e,onClose:a}){const[,t]=r.a.useContext(u),n=Object(ce.b)(),[s]=r.a.useContext(T.a),l=r.a.useCallback(e=>{s&&c.a.post("/api/chat-channels",e,{headers:{Authorization:s.token}}).then(a).then(()=>n.setValue("name","")).then(()=>n.clearError()).then(()=>t({type:"fetch-channels"})).catch(Object(D.handleRequestValidationError)(n))},[s,a,n,t]);return r.a.createElement(ie,{onClose:a,isOpen:e},r.a.createElement("form",{className:"shadow-lg",onSubmit:n.handleSubmit(l),style:{width:400}},r.a.createElement("div",{className:"p-8 pb-4 bg-white rounded-t border-solid border-blue-500 border-t-4"},r.a.createElement("h1",{className:"text-3xl font-light mb-4"},"Create a Channel"),r.a.createElement("label",{htmlFor:"add-channel-input"},r.a.createElement("div",{className:"sr-only"},"Channel Name"),r.a.createElement(me.a,{className:"w-full",id:"add-channel-input",name:"name",placeholder:"Enter Channel Name",ref:n.register({required:"Please enter a channel name"})})),r.a.createElement("span",{className:"text-xs text-red-700 ml-1"},n.errors.name?n.errors.name.message:r.a.createElement(r.a.Fragment,null," "))),r.a.createElement("div",{className:"p-6 text-right bg-gray-100 rounded-b"},r.a.createElement(ue.a,{className:"bg-gray-100 hover:bg-gray-200 text-gray-900 shadow-none hover:shadow-none",type:"button",onClick:a,overrideColors:!0},"Cancel"),r.a.createElement(ue.a,{className:"ml-4 bg-blue-700 hover:bg-blue-800 text-gray-100",type:"submit",overrideColors:!0},"Create"))))}de.propTypes={isOpen:k.a.bool,onClose:k.a.func},de.defaultProps={isOpen:!1,onClose:I.a()};var he=r.a.memo(de);var pe=function(e){return r.a.createElement("svg",ae()({viewBox:"0 0 24 24",width:"24",height:"24"},e),r.a.createElement("path",{d:"M12 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-2a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm9 11a1 1 0 0 1-2 0v-2a3 3 0 0 0-3-3H8a3 3 0 0 0-3 3v2a1 1 0 0 1-2 0v-2a5 5 0 0 1 5-5h8a5 5 0 0 1 5 5v2z"}))};var ge=function(e){return r.a.createElement("svg",ae()({viewBox:"0 0 24 24",width:"24",height:"24"},e),r.a.createElement("path",{d:"M17 11a1 1 0 0 1 0 2h-4v4a1 1 0 0 1-2 0v-4H7a1 1 0 0 1 0-2h4V7a1 1 0 0 1 2 0v4h4z"}))};function fe({channels:e}){const[a,t]=r.a.useContext(T.a),[n,l]=r.a.useState(!1),[c,o]=r.a.useState(!1),i=Object(s.f)(),m=r.a.useCallback(()=>{l(!1),o(!1)},[]),u=r.a.useCallback(()=>{l(f.a)},[]),d=r.a.useCallback(()=>{o(f.a)},[]),h=r.a.useCallback(()=>{t(null),i.push("/")},[t,i]);return r.a.createElement("div",{className:"h-screen w-56 px-2 mr-8 overflow-y-auto"},r.a.createElement("div",{className:"relative"},r.a.createElement("div",{className:"absolute w-full py-12"},r.a.createElement("button",{className:"w-full hover:bg-gray-200 rounded-lg p-1 pl-2",type:"button",onClick:d},r.a.createElement("div",{className:"flex items-center"},r.a.createElement(pe,{className:"fill-current text-gray-600"}),r.a.createElement("span",{className:"ml-4 font-bold text-lg text-gray-900"},a&&a.username))),r.a.createElement(M,{onClose:m,isOpen:c},r.a.createElement("div",{className:"absolute mt-2 bg-white rounded py-4 shadow-md"},r.a.createElement("button",{className:"px-8 py-1 hover:bg-blue-100 hover:text-blue-700",type:"button",onClick:h},"Sign out"))),r.a.createElement("div",{className:"text-gray-700 font-bold"},r.a.createElement("div",{className:"mt-8 mb-1 uppercase tracking-wide text-xs"},"Channels"),e.map(e=>r.a.createElement(le,{key:e._id,channel:e})),r.a.createElement("div",{className:"mt-8"},r.a.createElement("button",{type:"button",className:"block w-full flex items-center rounded-lg hover:bg-gray-200 text-gray-700 hover:text-gray-900 p-1",onClick:u},r.a.createElement(ge,{className:"fill-current text-gray-600 mr-1"}),"New Channel"),r.a.createElement("div",{className:"font-normal"},r.a.createElement(he,{isOpen:n,onClose:m})))))))}fe.propTypes={channels:k.a.arrayOf(k.a.shape({_id:k.a.string,name:k.a.string}))},fe.defaultProps={channels:[]};var ye=r.a.memo(fe);a.default=function(){const[{state:e,performEffect:a},t]=r.a.useReducer(h,void 0,d),n=Object(s.f)(),[l]=r.a.useContext(T.a);Object(R.a)(()=>{const{socket:a}=e;return a.on("chat message",e=>t({type:"recieve-message",payload:{chatMessage:e}})),a.on("start typing",e=>t({type:"add-user-typing",payload:{username:e}})),a.on("stop typing",e=>t({type:"remove-user-typing",payload:{username:e}})),a.close.bind(a)}),Object(R.a)(()=>{l||n.replace("/login")},[n,l]),r.a.useEffect(()=>{a&&a(t)},[t,a]);const c=r.a.useMemo(()=>[e,t],[e]);return r.a.createElement(u.Provider,{value:c},r.a.createElement("div",{className:"container mx-auto"},r.a.createElement("div",{className:"flex"},r.a.createElement(ye,{channels:e.channels}),r.a.createElement("div",{className:"h-screen flex flex-grow"},r.a.createElement(re,null)))))}},60:function(e,a,t){"use strict";var n=t(34),r=t.n(n),s=t(0),l=t.n(s),c=t(6),o=t.n(c);function i({className:e,children:a,type:t,overrideColors:n,variant:s,...c}){let o;return o="big"===s?"px-12 py-4 font-bold shadow-md hover:shadow-lg":"px-4 py-2 shadow hover:shadow-md",l.a.createElement("button",r()({className:`\n        ${n?"":"bg-gray-700 hover:bg-gray-800 text-gray-100"}\n        rounded focus:shadow-outline cursor-pointer ${o} ${e}\n      `,type:t},c),a)}i.propTypes={className:o.a.string,children:o.a.node,type:o.a.string,variant:o.a.oneOf(["big",void 0]),overrideColors:o.a.bool},i.defaultProps={className:"",children:null,type:"button",variant:void 0,overrideColors:!1},a.a=i},63:function(e,a,t){"use strict";var n=t(0),r=t.n(n);a.a=function(e){return r.a.useEffect(e,[]),null}},69:function(e,a,t){const{validationResult:n}=t(123),r=t(51),s=t(133),l=t(88),{theme:c}=s(l);const o=r.curry((e,a)=>r.compose(r.all(r.identity),r.values,r.pickAll(e))(a));const i=r.curry((e,a)=>{const t=a.response.data.errors;if(!t)throw a;r.forEachObjIndexed((a,t)=>{e.setError(t,"paramError",a&&a.msg)},t)});e.exports={theme:c,inspect:function(e){return console.log(e),e},hasProps:o,handleValidation:function(e,a,t){const r=n(e);r.isEmpty()?t():a.status(400).json({errors:r.mapped()})},handleRequestValidationError:i}},88:function(e,a){e.exports={variants:{textColor:["responsive","hover","focus","group-hover"],backgroundColor:["responsive","hover","focus","group-hover"]},theme:{extend:{fontFamily:{display:["Raleway","sans-serif"]}}}}},89:function(e,a,t){"use strict";var n=t(34),r=t.n(n),s=t(0),l=t.n(s),c=t(6),o=t.n(c);const i=["rounded-lg","bg-gray-200","px-3","py-2","border","border-solid","border-transparent","outline-none"].join(" "),m=l.a.forwardRef(({className:e,...a},t)=>l.a.createElement("input",r()({className:`${i} hover:border-gray-400 focus:bg-white focus:border-gray-400 ${e}`,ref:t},a)));m.propTypes={className:o.a.string},m.defaultProps={className:""},a.a=m}}]);
//# sourceMappingURL=chat.bundle.js.map